<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Screen Sharing</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 20px;
            background-color: #f4f4f4;
        }
        video {
            width: 80%;
            height: auto;
            background-color: black;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            margin-top: 20px;
            cursor: pointer;
        }
        #shareLink {
            margin-top: 20px;
            display: none;
        }
    </style>
</head>
<body>
    <h1>Simple Screen Sharing</h1>
    <video id="videoElement" autoplay playsinline controls></video>
    <br>
    <input type="text" id="userId" placeholder="Enter your ID" />
    <button id="startShare">Start Screen Share</button>
    <button id="startView" style="display:none;">Start Viewing</button>
    <div id="shareLink">
        <p>Share this link to view your screen: <a href="" id="link"></a></p>
    </div>

    <script>
        const startShareButton = document.getElementById("startShare");
        const startViewButton = document.getElementById("startView");
        const videoElement = document.getElementById("videoElement");
        const userIdInput = document.getElementById("userId");
        const shareLink = document.getElementById("shareLink");
        const linkElement = document.getElementById("link");

        const signalingServerUrl = "wss://screen-share-m7ua.onrender.com"; // Use your Render URL
        let peerConnection;
        let screenStream;
        const ws = new WebSocket(signalingServerUrl);

        // Configuration for STUN server
        const configuration = {
            iceServers: [
                { urls: "stun:stun.l.google.com:19302" }
            ]
        };

        ws.onopen = () => {
            console.log('Connected to signaling server');
        };

        // Start Screen Sharing
        startShareButton.addEventListener("click", async () => {
            const userId = userIdInput.value.trim();
            if (!userId) {
                alert('Please enter your ID');
                return;
            }
            try {
                screenStream = await navigator.mediaDevices.getDisplayMedia({ video: true });
                videoElement.srcObject = screenStream;

                peerConnection = new RTCPeerConnection(configuration);
                peerConnection.addTrack(screenStream.getTracks()[0], screenStream);

                peerConnection.onicecandidate = event => {
                    if (event.candidate) {
                        ws.send(JSON.stringify({ candidate: event.candidate, id: userId }));
                    }
                };

                const offer = await peerConnection.createOffer();
                await peerConnection.setLocalDescription(offer);
                ws.send(JSON.stringify({ offer, id: userId }));

                // Show the generated link
                const shareUrl = `${window.location.origin}${window.location.pathname}?id=${userId}`;
                linkElement.href = shareUrl;
                linkElement.textContent = shareUrl;
                shareLink.style.display = 'block';

                startShareButton.style.display = "none";
                startViewButton.style.display = "inline";

                // Notify the signaling server about the join
                ws.send(JSON.stringify({ action: 'join', id: userId }));
            } catch (err) {
                console.error("Error sharing screen:", err);
            }
        });

        // Start Viewing the shared screen
        startViewButton.addEventListener("click", () => {
            const userId = userIdInput.value.trim();
            if (!userId) {
                alert('Please enter the ID to view');
                return;
            }
            peerConnection = new RTCPeerConnection(configuration);

            peerConnection.ontrack = event => {
                videoElement.srcObject = event.streams[0];
            };

            peerConnection.onicecandidate = event => {
                if (event.candidate) {
                    ws.send(JSON.stringify({ candidate: event.candidate, id: userId }));
                }
            };

            // Notify the signaling server about the join
            ws.send(JSON.stringify({ action: 'join', id: userId }));
        });

        ws.onmessage = async message => {
            const data = JSON.parse(message.data);

            if (data.offer) {
                peerConnection = new RTCPeerConnection(configuration);
                peerConnection.ontrack = event => {
                    videoElement.srcObject = event.streams[0];
                };

                peerConnection.onicecandidate = event => {
                    if (event.candidate) {
                        ws.send(JSON.stringify({ candidate: event.candidate, id: data.id }));
                    }
                };

                await peerConnection.setRemoteDescription(new RTCSessionDescription(data.offer));
                const answer = await peerConnection.createAnswer();
                await peerConnection.setLocalDescription(answer);
                ws.send(JSON.stringify({ answer, id: data.id }));
            } else if (data.answer) {
                await peerConnection.setRemoteDescription(new RTCSessionDescription(data.answer));
            } else if (data.candidate) {
                await peerConnection.addIceCandidate(new RTCIceCandidate(data.candidate));
            }
        };

        // Automatically join the session if an ID is in the URL
        const params = new URLSearchParams(window.location.search);
        const viewId = params.get('id');
        if (viewId) {
            userIdInput.value = viewId;
            startViewButton.click();
        }
    </script>
</body>
</html>
IT WORKS!
